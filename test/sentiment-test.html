<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>감성 키워드 기반 장소 추천 테스트</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">🎭 감성 키워드 기반 장소 추천 테스트</h1>
        
        <!-- 키워드 추출 테스트 -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">1. 감성 키워드 추출 테스트</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">테스트 문장 입력:</label>
                <input 
                    type="text" 
                    id="testInput" 
                    placeholder="예: 분위기 좋은 카페 추천해줘"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
            </div>
            <button 
                onclick="extractKeywords()" 
                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
            >
                키워드 추출
            </button>
            <div id="keywordResult" class="mt-4 p-4 bg-gray-50 rounded-md hidden">
                <h3 class="font-medium mb-2">추출된 감성 키워드:</h3>
                <div id="keywordContent"></div>
            </div>
        </div>

        <!-- 장소 검색 테스트 -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">2. 감성 키워드 기반 장소 검색 테스트</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">검색어 입력:</label>
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="예: 분위기 좋은 한식집"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
            </div>
            <button 
                onclick="searchPlaces()" 
                class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700"
            >
                장소 검색
            </button>
            <div id="searchResult" class="mt-4 hidden">
                <h3 class="font-medium mb-2">검색 결과:</h3>
                <div id="searchContent"></div>
            </div>
        </div>

        <!-- 미리 정의된 테스트 케이스 -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">3. 미리 정의된 테스트 케이스</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-medium text-gray-700 mb-2">감성 키워드 포함:</h3>
                    <div class="space-y-2">
                        <button onclick="testCase('분위기 좋은 카페 추천해줘')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "분위기 좋은 카페 추천해줘"
                        </button>
                        <button onclick="testCase('맛있는 한식집 찾고 있어요')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "맛있는 한식집 찾고 있어요"
                        </button>
                        <button onclick="testCase('아늑한 레스토랑이 좋겠어요')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "아늑한 레스토랑이 좋겠어요"
                        </button>
                        <button onclick="testCase('가성비 좋은 음식점 어때요?')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "가성비 좋은 음식점 어때요?"
                        </button>
                    </div>
                </div>
                <div>
                    <h3 class="font-medium text-gray-700 mb-2">일반 키워드:</h3>
                    <div class="space-y-2">
                        <button onclick="testCase('친구들과 만날 곳 찾아줘')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "친구들과 만날 곳 찾아줘"
                        </button>
                        <button onclick="testCase('차로 이동할 수 있는 카페')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "차로 이동할 수 있는 카페"
                        </button>
                        <button onclick="testCase('지하철로 갈 수 있는 놀거리')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "지하철로 갈 수 있는 놀거리"
                        </button>
                        <button onclick="testCase('공원에서 산책하고 싶어요')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "공원에서 산책하고 싶어요"
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL 설정
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000'
            : 'https://wherewemeets-production.up.railway.app';

        // 감성 키워드 추출 테스트
        async function extractKeywords() {
            const input = document.getElementById('testInput').value.trim();
            if (!input) {
                alert('테스트 문장을 입력해주세요.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/places/sentiment/extract`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: input })
                });

                const data = await response.json();
                
                const resultDiv = document.getElementById('keywordResult');
                const contentDiv = document.getElementById('keywordContent');
                
                if (data.success) {
                    let html = `
                        <div class="mb-4">
                            <p class="font-medium">입력: "${data.input_text}"</p>
                            <p class="text-sm text-gray-600">전체 감성: ${data.extracted_keywords.overall_sentiment} (점수: ${data.extracted_keywords.sentiment_score})</p>
                        </div>
                    `;

                    // 카테고리별 키워드 표시
                    const categories = ['atmosphere', 'food', 'service', 'price', 'location'];
                    const categoryNames = {
                        atmosphere: '분위기',
                        food: '음식',
                        service: '서비스',
                        price: '가격',
                        location: '위치/접근성'
                    };

                    categories.forEach(category => {
                        if (data.extracted_keywords[category] && data.extracted_keywords[category].length > 0) {
                            html += `
                                <div class="mb-2">
                                    <span class="font-medium text-${category === 'atmosphere' ? 'purple' : 'blue'}-700">${categoryNames[category]}:</span>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        ${data.extracted_keywords[category].map(k => 
                                            `<span class="px-2 py-1 text-xs rounded ${k.sentiment === 'positive' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${k.keyword}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            `;
                        }
                    });

                    contentDiv.innerHTML = html;
                    resultDiv.classList.remove('hidden');
                } else {
                    contentDiv.innerHTML = `<p class="text-red-600">오류: ${data.message}</p>`;
                    resultDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('키워드 추출 실패:', error);
                alert('키워드 추출 중 오류가 발생했습니다.');
            }
        }

        // 장소 검색 테스트
        async function searchPlaces() {
            const input = document.getElementById('searchInput').value.trim();
            if (!input) {
                alert('검색어를 입력해주세요.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/places/search/sentiment?query=${encodeURIComponent(input)}&size=5`);
                const data = await response.json();
                
                const resultDiv = document.getElementById('searchResult');
                const contentDiv = document.getElementById('searchContent');
                
                if (data.success) {
                    let html = `
                        <div class="mb-4 p-3 bg-purple-50 rounded">
                            <p class="font-medium">검색어: "${input}"</p>
                            <p class="text-sm text-gray-600">찾은 장소: ${data.places.length}개</p>
                            ${data.sentiment_analysis ? `<p class="text-sm text-gray-600">감성 분석: ${data.sentiment_analysis.extracted_keywords.overall_sentiment}</p>` : ''}
                        </div>
                    `;

                    if (data.places.length > 0) {
                        html += '<div class="space-y-4">';
                        data.places.forEach((place, index) => {
                            html += `
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-medium">${place.name}</h4>
                                        <span class="text-sm text-gray-500">#${index + 1}</span>
                                    </div>
                                    <p class="text-sm text-gray-600">${place.address}</p>
                                    <p class="text-sm text-gray-600">평점: ${place.rating}/5.0</p>
                                    ${place.sentiment_analysis ? `
                                        <div class="mt-2 p-2 bg-purple-50 rounded">
                                            <p class="text-xs font-medium text-purple-700">감성 점수: ${place.sentiment_analysis.score}점</p>
                                            ${place.sentiment_analysis.matched_keywords.length > 0 ? 
                                                `<div class="flex flex-wrap gap-1 mt-1">
                                                    ${place.sentiment_analysis.matched_keywords.map(k => 
                                                        `<span class="px-2 py-1 text-xs bg-purple-100 text-purple-700 rounded">${k}</span>`
                                                    ).join('')}
                                                </div>` : ''
                                            }
                                            <p class="text-xs text-purple-600 mt-1">${place.sentiment_analysis.recommendation_reason}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        html += '</div>';
                    } else {
                        html += '<p class="text-gray-600">검색 결과가 없습니다.</p>';
                    }

                    contentDiv.innerHTML = html;
                    resultDiv.classList.remove('hidden');
                } else {
                    contentDiv.innerHTML = `<p class="text-red-600">오류: ${data.message}</p>`;
                    resultDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('장소 검색 실패:', error);
                alert('장소 검색 중 오류가 발생했습니다.');
            }
        }

        // 테스트 케이스 실행
        function testCase(query) {
            document.getElementById('testInput').value = query;
            document.getElementById('searchInput').value = query;
            
            // 키워드 추출과 장소 검색을 동시에 실행
            extractKeywords();
            setTimeout(() => searchPlaces(), 1000);
        }

        // 페이지 로드 시 안내 메시지
        window.addEventListener('load', function() {
            console.log('🎭 감성 키워드 기반 장소 추천 테스트 페이지 로드됨');
            console.log('API Base URL:', API_BASE_URL);
        });
    </script>
</body>
</html> 