<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°ì„± í‚¤ì›Œë“œ ê¸°ë°˜ ì¥ì†Œ ì¶”ì²œ í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-900 mb-8">ğŸ­ ê°ì„± í‚¤ì›Œë“œ ê¸°ë°˜ ì¥ì†Œ ì¶”ì²œ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- í‚¤ì›Œë“œ ì¶”ì¶œ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">1. ê°ì„± í‚¤ì›Œë“œ ì¶”ì¶œ í…ŒìŠ¤íŠ¸</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">í…ŒìŠ¤íŠ¸ ë¬¸ì¥ ì…ë ¥:</label>
                <input 
                    type="text" 
                    id="testInput" 
                    placeholder="ì˜ˆ: ë¶„ìœ„ê¸° ì¢‹ì€ ì¹´í˜ ì¶”ì²œí•´ì¤˜"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
            </div>
            <button 
                onclick="extractKeywords()" 
                class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
            >
                í‚¤ì›Œë“œ ì¶”ì¶œ
            </button>
            <div id="keywordResult" class="mt-4 p-4 bg-gray-50 rounded-md hidden">
                <h3 class="font-medium mb-2">ì¶”ì¶œëœ ê°ì„± í‚¤ì›Œë“œ:</h3>
                <div id="keywordContent"></div>
            </div>
        </div>

        <!-- ì¥ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">2. ê°ì„± í‚¤ì›Œë“œ ê¸°ë°˜ ì¥ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">ê²€ìƒ‰ì–´ ì…ë ¥:</label>
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="ì˜ˆ: ë¶„ìœ„ê¸° ì¢‹ì€ í•œì‹ì§‘"
                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
            </div>
            <button 
                onclick="searchPlaces()" 
                class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700"
            >
                ì¥ì†Œ ê²€ìƒ‰
            </button>
            <div id="searchResult" class="mt-4 hidden">
                <h3 class="font-medium mb-2">ê²€ìƒ‰ ê²°ê³¼:</h3>
                <div id="searchContent"></div>
            </div>
        </div>

        <!-- ë¯¸ë¦¬ ì •ì˜ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ -->
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-semibold mb-4">3. ë¯¸ë¦¬ ì •ì˜ëœ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤</h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div>
                    <h3 class="font-medium text-gray-700 mb-2">ê°ì„± í‚¤ì›Œë“œ í¬í•¨:</h3>
                    <div class="space-y-2">
                        <button onclick="testCase('ë¶„ìœ„ê¸° ì¢‹ì€ ì¹´í˜ ì¶”ì²œí•´ì¤˜')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "ë¶„ìœ„ê¸° ì¢‹ì€ ì¹´í˜ ì¶”ì²œí•´ì¤˜"
                        </button>
                        <button onclick="testCase('ë§›ìˆëŠ” í•œì‹ì§‘ ì°¾ê³  ìˆì–´ìš”')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "ë§›ìˆëŠ” í•œì‹ì§‘ ì°¾ê³  ìˆì–´ìš”"
                        </button>
                        <button onclick="testCase('ì•„ëŠ‘í•œ ë ˆìŠ¤í† ë‘ì´ ì¢‹ê² ì–´ìš”')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "ì•„ëŠ‘í•œ ë ˆìŠ¤í† ë‘ì´ ì¢‹ê² ì–´ìš”"
                        </button>
                        <button onclick="testCase('ê°€ì„±ë¹„ ì¢‹ì€ ìŒì‹ì  ì–´ë•Œìš”?')" class="block w-full text-left p-2 bg-purple-50 hover:bg-purple-100 rounded">
                            "ê°€ì„±ë¹„ ì¢‹ì€ ìŒì‹ì  ì–´ë•Œìš”?"
                        </button>
                    </div>
                </div>
                <div>
                    <h3 class="font-medium text-gray-700 mb-2">ì¼ë°˜ í‚¤ì›Œë“œ:</h3>
                    <div class="space-y-2">
                        <button onclick="testCase('ì¹œêµ¬ë“¤ê³¼ ë§Œë‚  ê³³ ì°¾ì•„ì¤˜')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "ì¹œêµ¬ë“¤ê³¼ ë§Œë‚  ê³³ ì°¾ì•„ì¤˜"
                        </button>
                        <button onclick="testCase('ì°¨ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ì¹´í˜')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "ì°¨ë¡œ ì´ë™í•  ìˆ˜ ìˆëŠ” ì¹´í˜"
                        </button>
                        <button onclick="testCase('ì§€í•˜ì² ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” ë†€ê±°ë¦¬')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "ì§€í•˜ì² ë¡œ ê°ˆ ìˆ˜ ìˆëŠ” ë†€ê±°ë¦¬"
                        </button>
                        <button onclick="testCase('ê³µì›ì—ì„œ ì‚°ì±…í•˜ê³  ì‹¶ì–´ìš”')" class="block w-full text-left p-2 bg-blue-50 hover:bg-blue-100 rounded">
                            "ê³µì›ì—ì„œ ì‚°ì±…í•˜ê³  ì‹¶ì–´ìš”"
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL ì„¤ì •
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:5000'
            : 'https://wherewemeets-production.up.railway.app';

        // ê°ì„± í‚¤ì›Œë“œ ì¶”ì¶œ í…ŒìŠ¤íŠ¸
        async function extractKeywords() {
            const input = document.getElementById('testInput').value.trim();
            if (!input) {
                alert('í…ŒìŠ¤íŠ¸ ë¬¸ì¥ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/places/sentiment/extract`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ text: input })
                });

                const data = await response.json();
                
                const resultDiv = document.getElementById('keywordResult');
                const contentDiv = document.getElementById('keywordContent');
                
                if (data.success) {
                    let html = `
                        <div class="mb-4">
                            <p class="font-medium">ì…ë ¥: "${data.input_text}"</p>
                            <p class="text-sm text-gray-600">ì „ì²´ ê°ì„±: ${data.extracted_keywords.overall_sentiment} (ì ìˆ˜: ${data.extracted_keywords.sentiment_score})</p>
                        </div>
                    `;

                    // ì¹´í…Œê³ ë¦¬ë³„ í‚¤ì›Œë“œ í‘œì‹œ
                    const categories = ['atmosphere', 'food', 'service', 'price', 'location'];
                    const categoryNames = {
                        atmosphere: 'ë¶„ìœ„ê¸°',
                        food: 'ìŒì‹',
                        service: 'ì„œë¹„ìŠ¤',
                        price: 'ê°€ê²©',
                        location: 'ìœ„ì¹˜/ì ‘ê·¼ì„±'
                    };

                    categories.forEach(category => {
                        if (data.extracted_keywords[category] && data.extracted_keywords[category].length > 0) {
                            html += `
                                <div class="mb-2">
                                    <span class="font-medium text-${category === 'atmosphere' ? 'purple' : 'blue'}-700">${categoryNames[category]}:</span>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        ${data.extracted_keywords[category].map(k => 
                                            `<span class="px-2 py-1 text-xs rounded ${k.sentiment === 'positive' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">${k.keyword}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            `;
                        }
                    });

                    contentDiv.innerHTML = html;
                    resultDiv.classList.remove('hidden');
                } else {
                    contentDiv.innerHTML = `<p class="text-red-600">ì˜¤ë¥˜: ${data.message}</p>`;
                    resultDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('í‚¤ì›Œë“œ ì¶”ì¶œ ì‹¤íŒ¨:', error);
                alert('í‚¤ì›Œë“œ ì¶”ì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¥ì†Œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
        async function searchPlaces() {
            const input = document.getElementById('searchInput').value.trim();
            if (!input) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/places/search/sentiment?query=${encodeURIComponent(input)}&size=5`);
                const data = await response.json();
                
                const resultDiv = document.getElementById('searchResult');
                const contentDiv = document.getElementById('searchContent');
                
                if (data.success) {
                    let html = `
                        <div class="mb-4 p-3 bg-purple-50 rounded">
                            <p class="font-medium">ê²€ìƒ‰ì–´: "${input}"</p>
                            <p class="text-sm text-gray-600">ì°¾ì€ ì¥ì†Œ: ${data.places.length}ê°œ</p>
                            ${data.sentiment_analysis ? `<p class="text-sm text-gray-600">ê°ì„± ë¶„ì„: ${data.sentiment_analysis.extracted_keywords.overall_sentiment}</p>` : ''}
                        </div>
                    `;

                    if (data.places.length > 0) {
                        html += '<div class="space-y-4">';
                        data.places.forEach((place, index) => {
                            html += `
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <h4 class="font-medium">${place.name}</h4>
                                        <span class="text-sm text-gray-500">#${index + 1}</span>
                                    </div>
                                    <p class="text-sm text-gray-600">${place.address}</p>
                                    <p class="text-sm text-gray-600">í‰ì : ${place.rating}/5.0</p>
                                    ${place.sentiment_analysis ? `
                                        <div class="mt-2 p-2 bg-purple-50 rounded">
                                            <p class="text-xs font-medium text-purple-700">ê°ì„± ì ìˆ˜: ${place.sentiment_analysis.score}ì </p>
                                            ${place.sentiment_analysis.matched_keywords.length > 0 ? 
                                                `<div class="flex flex-wrap gap-1 mt-1">
                                                    ${place.sentiment_analysis.matched_keywords.map(k => 
                                                        `<span class="px-2 py-1 text-xs bg-purple-100 text-purple-700 rounded">${k}</span>`
                                                    ).join('')}
                                                </div>` : ''
                                            }
                                            <p class="text-xs text-purple-600 mt-1">${place.sentiment_analysis.recommendation_reason}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        });
                        html += '</div>';
                    } else {
                        html += '<p class="text-gray-600">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                    }

                    contentDiv.innerHTML = html;
                    resultDiv.classList.remove('hidden');
                } else {
                    contentDiv.innerHTML = `<p class="text-red-600">ì˜¤ë¥˜: ${data.message}</p>`;
                    resultDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('ì¥ì†Œ ê²€ìƒ‰ ì‹¤íŒ¨:', error);
                alert('ì¥ì†Œ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹¤í–‰
        function testCase(query) {
            document.getElementById('testInput').value = query;
            document.getElementById('searchInput').value = query;
            
            // í‚¤ì›Œë“œ ì¶”ì¶œê³¼ ì¥ì†Œ ê²€ìƒ‰ì„ ë™ì‹œì— ì‹¤í–‰
            extractKeywords();
            setTimeout(() => searchPlaces(), 1000);
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•ˆë‚´ ë©”ì‹œì§€
        window.addEventListener('load', function() {
            console.log('ğŸ­ ê°ì„± í‚¤ì›Œë“œ ê¸°ë°˜ ì¥ì†Œ ì¶”ì²œ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œë¨');
            console.log('API Base URL:', API_BASE_URL);
        });
    </script>
</body>
</html> 